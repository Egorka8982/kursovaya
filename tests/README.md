# Тесты на Selenium

Этот каталог содержит автоматические тесты для веб-приложения ветеринарной клиники.

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. ChromeDriver устанавливается автоматически через `webdriver-manager` - ничего дополнительно делать не нужно!

## Запуск тестов

### Запуск всех тестов:
```bash
pytest tests/
```

### Запуск конкретного файла:
```bash
pytest tests/test_clients.py
```

### Запуск с выводом:
```bash
pytest tests/ -v
```

### Запуск с отображением браузера (без headless):
Измените в `tests/conftest.py`:
```python
chrome_options.add_argument("--headless")  # Удалите или закомментируйте эту строку
```

### Использование скриптов запуска:

**Windows:**
```bash
tests\run_tests.bat
```

**Linux/Mac:**
```bash
bash tests/run_tests.sh
```

## Структура тестов

- `conftest.py` - конфигурация и фикстуры (автоматический запуск сервера, настройка WebDriver)
- `test_main_page.py` - тесты главной страницы (навигация, ссылки)
- `test_clients.py` - тесты страницы клиентов (добавление, просмотр таблицы)
- `test_animals.py` - тесты страницы животных (добавление, кнопка обновления)
- `run_tests.bat` - скрипт запуска тестов для Windows
- `run_tests.sh` - скрипт запуска тестов для Linux/Mac

## Добавление новых тестов

1. Создайте новый файл `test_*.py`
2. Используйте фикстуры из `conftest.py`:
   - `driver` - WebDriver
   - `base_url` - URL приложения
   - `server_process` - запущенный сервер

Пример:
```python
def test_my_feature(driver, base_url, server_process):
    driver.get(f"{base_url}/my-page")
    # Ваши проверки
```

## Что тестируется

✅ Открытие всех основных страниц  
✅ Навигация между страницами  
✅ Добавление новых записей (клиенты, животные)  
✅ Отображение данных в таблицах  
✅ Работа модальных окон  
✅ Кнопки обновления  

## Особенности

- **Автоматическая установка ChromeDriver** - не нужно скачивать вручную
- **Автоматический запуск сервера** - сервер запускается перед тестами и останавливается после
- **Headless режим** по умолчанию - тесты запускаются без GUI (быстрее)
- **Надежные ожидания** - используется WebDriverWait для стабильности тестов

## Решение проблем

### ERROR vs FAILED

- **ERROR** - тест упал до выполнения (проблема в фикстурах, setup, импортах)
- **FAILED** - тест выполнился, но assertion не прошел

Если видите ERROR, скорее всего проблема в:
1. Фикстуре `server_process` - сервер не запускается
2. Фикстуре `driver` - ChromeDriver не создается
3. Импортах или синтаксических ошибках

### Тесты падают с ERROR (сервер не запускается)

**Диагностика:**
1. Запустите скрипт отладки:
```bash
python tests/debug_server.py
```

2. Проверьте что сервер запускается вручную:
```bash
python main.py
```

3. Проверьте что порт свободен:
```bash
# Windows
netstat -ano | findstr :8007
# Linux/Mac
lsof -i :8007
```

**Решение:**
- Убедитесь что все зависимости установлены: `pip install -r requirements.txt`
- Закройте другие приложения на порту 8007
- Проверьте что виртуальное окружение активировано

### Тесты падают с TimeoutException

- Увеличьте таймауты в тестах (сейчас 15 секунд)
- Проверьте, что сервер запускается корректно
- Запустите тесты с отображением браузера для отладки

### ChromeDriver не устанавливается

- Проверьте интернет-соединение
- Убедитесь, что `webdriver-manager` установлен: `pip install webdriver-manager`
- Убедитесь, что Google Chrome установлен

